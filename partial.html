<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Room Planner</title>
    <style>
        body { 
            margin: 0; 
            font-family: Arial, sans-serif; 
            display: flex;
        }
        #sidebar { 
            width: 300px; 
            padding: 20px; 
            background: #f0f0f0; 
            height: 100vh; 
            overflow-y: auto;
        }
        #canvas-container { 
            flex: 1; 
            position: relative;
        }
        #canvas { 
            width: 100%; 
            height: 100vh; 
        }
        .section { 
            margin-bottom: 20px; 
        }
        .section h2 { 
            font-size: 18px; 
            margin-bottom: 10px; 
        }
        .furniture-item { 
            cursor: pointer; 
            padding: 5px; 
            margin: 5px 0; 
            background: #ddd; 
            border-radius: 4px; 
        }
        .furniture-item:hover { 
            background: #ccc; 
        }
        select, input, button { 
            margin: 5px 0; 
            padding: 5px; 
            width: 100%; 
            box-sizing: border-box; 
        }
        #controls { 
            position: absolute; 
            bottom: 10px; 
            left: 10px; 
            background: rgba(0,0,0,0.7); 
            color: white; 
            padding: 10px; 
            border-radius: 4px; 
        }
        #loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 24px; 
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="sidebar">
        <div class="section">
            <h2>Room Shape</h2>
            <select id="room-shape">
                <option value="rectangle">Rectangle</option>
                <option value="l-shape">L-Shape</option>
                <option value="custom">Custom</option>
            </select>
            <input type="number" id="room-width" placeholder="Width (m)" value="5">
            <input type="number" id="room-depth" placeholder="Depth (m)" value="5">
            <button onclick="applyRoomShape()">Apply Shape</button>
        </div>

        <div class="section">
            <h2>Furniture</h2>
            <div class="furniture-item" onclick="addFurniture('bed')">üõèÔ∏è Bed</div>
            <div class="furniture-item" onclick="addFurniture('wardrobe')">üö™ Wardrobe</div>
            <div class="furniture-item" onclick="addFurniture('desk')">üóÑÔ∏è Desk</div>
            <div class="furniture-item" onclick="addFurniture('chair')">ü™ë Chair</div>
            <div class="furniture-item" onclick="addFurniture('sofa')">üõãÔ∏è Sofa</div>
            <div class="furniture-item" onclick="addFurniture('table')">‚¨ú Table</div>
        </div>

        <div class="section">
            <h2>Room Settings</h2>
            <label>Wall Height</label>
            <input type="number" id="wall-height" value="3" step="0.1">m
            <label>Floor Material</label>
            <select id="floor-material">
                <option value="wood">Wood</option>
                <option value="tiles">Tiles</option>
                <option value="carpet">Carpet</option>
                <option value="concrete">Concrete</option>
            </select>
            <button onclick="applyRoomSettings()">Apply Settings</button>
        </div>

        <div class="section">
            <h2>Actions</h2>
            <button onclick="clearRoom()">Clear Room</button>
            <button onclick="saveLayout()">Save Layout</button>
            <button onclick="loadLayout()">Load Layout</button>
            <button onclick="randomLayout()">Random Layout</button>
            <p><strong>Controls:</strong><br>
                ‚Ä¢ Left click + drag: Rotate view<br>
                ‚Ä¢ Right click + drag: Pan<br>
                ‚Ä¢ Scroll: Zoom in/out<br>
                ‚Ä¢ Click furniture to add<br>
                ‚Ä¢ Click placed item to select<br>
                ‚Ä¢ Delete key: Remove selected
            </p>
        </div>
    </div>

    <div id="canvas-container">
        <div id="loading">Loading 3D Environment...</div>
        <canvas id="canvas"></canvas>
        <div id="controls">
            <button onclick="setCameraView('top')">Top</button>
            <button onclick="setCameraView('perspective')">Perspective</button>
            <button onclick="setCameraView('front')">Front</button>
            <button onclick="setCameraView('side')">Side</button>
            <p>Left Mouse: Rotate ‚Ä¢ Right Mouse: Pan ‚Ä¢ Scroll: Zoom</p>
        </div>
    </div>

    <script>
        let scene, camera, renderer, controls, raycaster, mouse, selectedObject = null;
        let room, furniture = [];
        const floorMaterials = {
            wood: new THREE.MeshStandardMaterial({ color: 0x8B4513 }),
            tiles: new THREE.MeshStandardMaterial({ color: 0xAAAAAA }),
            carpet: new THREE.MeshStandardMaterial({ color: 0x483D8B }),
            concrete: new THREE.MeshStandardMaterial({ color: 0x808080 })
        };

        const furnitureGeometries = {
            bed: new THREE.BoxGeometry(2, 0.5, 1.5),
            wardrobe: new THREE.BoxGeometry(1, 2, 0.5),
            desk: new THREE.BoxGeometry(1.5, 0.8, 0.7),
            chair: new THREE.BoxGeometry(0.5, 0.8, 0.5),
            sofa: new THREE.BoxGeometry(2, 0.8, 0.8),
            table: new THREE.BoxGeometry(1.2, 0.8, 0.8)
        };

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
            renderer.setSize(window.innerWidth - 300, window.innerHeight);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            const light = new THREE.DirectionalLight(0xffffff, 0.8);
            light.position.set(5, 5, 5);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));

            createRoom(5, 5, 3);
            document.getElementById('loading').style.display = 'none';

            window.addEventListener('resize', () => {
                renderer.setSize(window.innerWidth - 300, window.innerHeight);
                camera.aspect = (window.innerWidth - 300) / window.innerHeight;
                camera.updateProjectionMatrix();
            });

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('click', onMouseClick);
            document.addEventListener('keydown', onKeyDown);
            animate();
        }

        function createRoom(width, depth, height, shape = 'rectangle') {
            if (room) scene.remove(room);
            const floorGeometry = shape === 'l-shape' 
                ? new THREE.ShapeGeometry(new THREE.Shape([
                    new THREE.Vector2(0, 0),
                    new THREE.Vector2(width, 0),
                    new THREE.Vector2(width, depth * 0.6),
                    new THREE.Vector2(width * 0.6, depth * 0.6),
                    new THREE.Vector2(width * 0.6, depth),
                    new THREE.Vector2(0, depth)
                ]))
                : new THREE.PlaneGeometry(width, depth);
                
            floorGeometry.rotateX(-Math.PI / 2);
            const floor = new THREE.Mesh(floorGeometry, floorMaterials.wood);
            scene.add(floor);

            const wallMaterial = new THREE.MeshStandardMaterial({ color: 0xF5F5F5 });
            const wallGeometry = new THREE.PlaneGeometry(width, height);
            const wall1 = new THREE.Mesh(wallGeometry, wallMaterial);
            wall1.position.set(0, height / 2, -depth / 2);
            const wall2 = new THREE.Mesh(wallGeometry, wallMaterial);
            wall2.position.set(0, height / 2, depth / 2);
            wall2.rotation.y = Math.PI;
            const wall3 = new THREE.Mesh(new THREE.PlaneGeometry(depth, height), wallMaterial);
            wall3.position.set(-width / 2, height / 2, 0);
            wall3.rotation.y = Math.PI / 2;
            const wall4 = new THREE.Mesh(new THREE.PlaneGeometry(depth, height), wallMaterial);
            wall4.position.set(width / 2, height / 2, 0);
            wall4.rotation.y = -Math.PI / 2;

            room = new THREE.Group();
            room.add(floor, wall1, wall2, wall3, wall4);
            scene.add(room);
        }

        function addFurniture(type) {
            const geometry = furnitureGeometries[type];
            const material = new THREE.MeshStandardMaterial({ color: Math.random() * 0xffffff });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set((Math.random() - 0.5) * 4, geometry.parameters.height / 2, (Math.random() - 0.5) * 4);
            scene.add(mesh);
            furniture.push(mesh);
        }

        function applyRoomShape() {
            const shape = document.getElementById('room-shape').value;
            const width = parseFloat(document.getElementById('room-width').value) || 5;
            const depth = parseFloat(document.getElementById('room-depth').value) || 5;
            const height = parseFloat(document.getElementById('wall-height').value) || 3;
            createRoom(width, depth, height, shape);
        }

        function applyRoomSettings() {
            const material = document.getElementById('floor-material').value;
            room.children[0].material = floorMaterials[material];
            applyRoomShape();
        }

        function clearRoom() {
            furniture.forEach(item => scene.remove(item));
            furniture = [];
        }

        function saveLayout() {
            const layout = {
                shape: document.getElementById('room-shape').value,
                width: parseFloat(document.getElementById('room-width').value),
                depth: parseFloat(document.getElementById('room-depth').value),
                height: parseFloat(document.getElementById('wall-height').value),
                material: document.getElementById('floor-material').value,
                furniture: furniture.map(item => ({
                    type: Object.keys(furnitureGeometries).find(key => furnitureGeometries[key] === item.geometry),
                    position: item.position.toArray(),
                    rotation: item.rotation.toArray()
                }))
            };
            localStorage.setItem('roomLayout', JSON.stringify(layout));
            alert('Layout saved!');
        }

        function loadLayout() {
            const layout = JSON.parse(localStorage.getItem('roomLayout'));
            if (layout) {
                document.getElementById('room-shape').value = layout.shape;
                document.getElementById('room-width').value = layout.width;
                document.getElementById('room-depth').value = layout.depth;
                document.getElementById('wall-height').value = layout.height;
                document.getElementById('floor-material').value = layout.material;
                clearRoom();
                createRoom(layout.width, layout.depth, layout.height, layout.shape);
                layout.furniture.forEach(item => {
                    const geometry = furnitureGeometries[item.type];
                    const material = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.fromArray(item.position);
                    mesh.rotation.fromArray(item.rotation);
                    scene.add(mesh);
                    furniture.push(mesh);
                });
                room.children[0].material = floorMaterials[layout.material];
            }
        }

        function randomLayout() {
            clearRoom();
            const types = Object.keys(furnitureGeometries);
            for (let i = 0; i < 5; i++) {
                addFurniture(types[Math.floor(Math.random() * types.length)]);
            }
        }

        function setCameraView(view) {
            const width = parseFloat(document.getElementById('room-width').value) || 5;
            const depth = parseFloat(document.getElementById('room-depth').value) || 5;
            const height = parseFloat(document.getElementById('wall-height').value) || 3;
            switch (view) {
                case 'top':
                    camera.position.set(0, height * 2, 0);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'perspective':
                    camera.position.set(width, height, depth);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'front':
                    camera.position.set(0, height / 2, depth * 1.5);
                    camera.lookAt(0, height / 2, 0);
                    break;
                case 'side':
                    camera.position.set(width * 1.5, height / 2, 0);
                    camera.lookAt(0, height / 2, 0);
                    break;
            }
        }

        function onMouseMove(event) {
            mouse.x = ((event.clientX - 300) / (window.innerWidth - 300)) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onMouseClick(event) {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(furniture);
            if (intersects.length > 0) {
                selectedObject = intersects[0].object;
            } else {
                selectedObject = null;
            }
        }

        function onKeyDown(event) {
            if (event.key === 'Delete' && selectedObject) {
                scene.remove(selectedObject);
                furniture = furniture.filter(item => item !== selectedObject);
                selectedObject = null;
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>