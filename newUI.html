<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèóÔ∏è 3D Room Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            overflow-x: auto;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8rem;
            text-align: center;
            background: linear-gradient(45deg, #3498db, #2c3e50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .toolbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .toolbar button {
            background: linear-gradient(45deg, #3498db, #2c3e50);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .toolbar button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .room-container {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1200px;
            perspective-origin: center center;
        }

        .room-3d {
            width: 800px;
            height: 600px;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(45deg) rotateY(15deg) rotateZ(0deg);
            transition: transform 0.5s ease;
        }

        /* Room structure */
        .room-floor {
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(236, 240, 241, 0.9) 25%, 
                rgba(189, 195, 199, 0.3) 25%, 
                rgba(189, 195, 199, 0.3) 50%, 
                rgba(236, 240, 241, 0.9) 50%, 
                rgba(236, 240, 241, 0.9) 75%, 
                rgba(189, 195, 199, 0.3) 75%
            );
            background-size: 50px 50px;
            border: 3px solid #34495e;
            border-radius: 10px;
            position: absolute;
            transform-style: preserve-3d;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* Walls */
        .wall {
            position: absolute;
            background: linear-gradient(135deg, rgba(200, 200, 200, 0.8), rgba(170, 170, 170, 0.9));
            border: 2px solid #34495e;
            transform-style: preserve-3d;
        }

        .wall-back {
            width: 100%;
            height: 200px;
            top: -200px;
            left: 0;
            transform-origin: bottom;
            transform: rotateX(90deg);
            background: linear-gradient(135deg, rgba(230, 230, 230, 0.9), rgba(200, 200, 200, 0.8));
        }

        .wall-front {
            width: 100%;
            height: 200px;
            bottom: -200px;
            left: 0;
            transform-origin: top;
            transform: rotateX(-90deg);
            background: linear-gradient(135deg, rgba(220, 220, 220, 0.8), rgba(190, 190, 190, 0.9));
        }

        .wall-left {
            width: 200px;
            height: 100%;
            top: 0;
            left: -200px;
            transform-origin: right;
            transform: rotateY(90deg);
            background: linear-gradient(135deg, rgba(240, 240, 240, 0.8), rgba(210, 210, 210, 0.9));
        }

        .wall-right {
            width: 200px;
            height: 100%;
            top: 0;
            right: -200px;
            transform-origin: left;
            transform: rotateY(-90deg);
            background: linear-gradient(135deg, rgba(235, 235, 235, 0.8), rgba(205, 205, 205, 0.9));
        }

        .furniture-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }

        .furniture-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 3px solid #3498db;
            border-radius: 15px;
            padding: 20px;
            cursor: grab;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.2);
            position: relative;
            overflow: hidden;
        }

        .furniture-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 35px rgba(52, 152, 219, 0.4);
            border-color: #2c3e50;
        }

        .furniture-item:active {
            cursor: grabbing;
        }

        .furniture-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .furniture-name {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* 3D Furniture Styles */
        .placed-furniture {
            position: absolute;
            cursor: move;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
            user-select: none;
        }

        .placed-furniture:hover {
            filter: brightness(1.1);
        }

        .placed-furniture.selected {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* 3D Furniture Models */
        .furniture-3d {
            position: relative;
            transform-style: preserve-3d;
        }

        /* Bed 3D */
        .bed-3d {
            width: 120px;
            height: 200px;
        }

        .bed-frame {
            width: 120px;
            height: 200px;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border: 2px solid #654321;
            position: absolute;
            transform: translateZ(10px);
            border-radius: 5px;
        }

        .bed-mattress {
            width: 115px;
            height: 195px;
            background: linear-gradient(135deg, #E6E6FA, #DDA0DD);
            border: 1px solid #9370DB;
            position: absolute;
            left: 2.5px;
            top: 2.5px;
            transform: translateZ(20px);
            border-radius: 3px;
        }

        .bed-pillow {
            width: 110px;
            height: 30px;
            background: linear-gradient(135deg, #F0F8FF, #E0E6FF);
            border: 1px solid #B0C4DE;
            position: absolute;
            left: 5px;
            top: 5px;
            transform: translateZ(25px);
            border-radius: 15px;
        }

        /* Wardrobe 3D */
        .wardrobe-3d {
            width: 100px;
            height: 60px;
        }

        .wardrobe-body {
            width: 100px;
            height: 60px;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border: 2px solid #654321;
            position: absolute;
            transform: translateZ(150px);
            border-radius: 5px;
        }

        .wardrobe-door-left {
            width: 45px;
            height: 55px;
            background: linear-gradient(135deg, #DEB887, #CD853F);
            border: 1px solid #8B7355;
            position: absolute;
            left: 2.5px;
            top: 2.5px;
            transform: translateZ(155px);
            border-radius: 3px;
        }

        .wardrobe-door-right {
            width: 45px;
            height: 55px;
            background: linear-gradient(135deg, #DEB887, #CD853F);
            border: 1px solid #8B7355;
            position: absolute;
            right: 2.5px;
            top: 2.5px;
            transform: translateZ(155px);
            border-radius: 3px;
        }

        .wardrobe-handle-left {
            width: 3px;
            height: 8px;
            background: #FFD700;
            position: absolute;
            right: 5px;
            top: 23px;
            transform: translateZ(158px);
            border-radius: 2px;
        }

        .wardrobe-handle-right {
            width: 3px;
            height: 8px;
            background: #FFD700;
            position: absolute;
            left: 5px;
            top: 23px;
            transform: translateZ(158px);
            border-radius: 2px;
        }

        /* Table 3D */
        .table-3d {
            width: 120px;
            height: 80px;
        }

        .table-top {
            width: 120px;
            height: 80px;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border: 2px solid #654321;
            position: absolute;
            transform: translateZ(50px);
            border-radius: 5px;
        }

        .table-leg {
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #654321, #8B4513);
            position: absolute;
            border-radius: 2px;
        }

        .table-leg-1 {
            left: 10px;
            top: 10px;
            height: 50px;
            transform: translateZ(0px);
        }

        .table-leg-2 {
            right: 10px;
            top: 10px;
            height: 50px;
            transform: translateZ(0px);
        }

        .table-leg-3 {
            left: 10px;
            bottom: 10px;
            height: 50px;
            transform: translateZ(0px);
        }

        .table-leg-4 {
            right: 10px;
            bottom: 10px;
            height: 50px;
            transform: translateZ(0px);
        }

        /* Chair 3D */
        .chair-3d {
            width: 45px;
            height: 45px;
        }

        .chair-seat {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #8B0000, #A52A2A);
            border: 1px solid #800000;
            position: absolute;
            transform: translateZ(40px);
            border-radius: 3px;
        }

        .chair-back {
            width: 45px;
            height: 50px;
            background: linear-gradient(135deg, #8B0000, #A52A2A);
            border: 1px solid #800000;
            position: absolute;
            top: -25px;
            transform: translateZ(43px);
            border-radius: 3px 3px 0 0;
        }

        .chair-leg {
            width: 5px;
            height: 5px;
            background: #654321;
            position: absolute;
            border-radius: 1px;
        }

        .chair-leg-1 {
            left: 5px;
            top: 5px;
            height: 40px;
            transform: translateZ(0px);
        }

        .chair-leg-2 {
            right: 5px;
            top: 5px;
            height: 40px;
            transform: translateZ(0px);
        }

        .chair-leg-3 {
            left: 5px;
            bottom: 5px;
            height: 40px;
            transform: translateZ(0px);
        }

        .chair-leg-4 {
            right: 5px;
            bottom: 5px;
            height: 40px;
            transform: translateZ(0px);
        }

        /* Sofa 3D */
        .sofa-3d {
            width: 160px;
            height: 80px;
        }

        .sofa-base {
            width: 160px;
            height: 80px;
            background: linear-gradient(135deg, #4B0082, #6A5ACD);
            border: 2px solid #483D8B;
            position: absolute;
            transform: translateZ(40px);
            border-radius: 10px;
        }

        .sofa-back {
            width: 160px;
            height: 40px;
            background: linear-gradient(135deg, #4B0082, #6A5ACD);
            border: 2px solid #483D8B;
            position: absolute;
            top: -20px;
            transform: translateZ(45px);
            border-radius: 10px 10px 5px 5px;
        }

        .sofa-arm-left {
            width: 20px;
            height: 80px;
            background: linear-gradient(135deg, #4B0082, #6A5ACD);
            border: 2px solid #483D8B;
            position: absolute;
            left: -15px;
            transform: translateZ(42px);
            border-radius: 10px 0 0 10px;
        }

        .sofa-arm-right {
            width: 20px;
            height: 80px;
            background: linear-gradient(135deg, #4B0082, #6A5ACD);
            border: 2px solid #483D8B;
            position: absolute;
            right: -15px;
            transform: translateZ(42px);
            border-radius: 0 10px 10px 0;
        }

        /* Side Table 3D */
        .side-table-3d {
            width: 50px;
            height: 50px;
        }

        .side-table-top {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border: 2px solid #654321;
            position: absolute;
            transform: translateZ(45px);
            border-radius: 5px;
        }

        .side-table-drawer {
            width: 40px;
            height: 8px;
            background: linear-gradient(135deg, #DEB887, #CD853F);
            border: 1px solid #8B7355;
            position: absolute;
            left: 5px;
            top: 10px;
            transform: translateZ(48px);
            border-radius: 2px;
        }

        .side-table-handle {
            width: 8px;
            height: 2px;
            background: #FFD700;
            position: absolute;
            left: 21px;
            top: 13px;
            transform: translateZ(50px);
            border-radius: 1px;
        }

        .side-table-leg {
            width: 6px;
            height: 6px;
            background: #654321;
            position: absolute;
            border-radius: 1px;
        }

        .side-table-leg-1 {
            left: 5px;
            top: 5px;
            height: 45px;
            transform: translateZ(0px);
        }

        .side-table-leg-2 {
            right: 5px;
            top: 5px;
            height: 45px;
            transform: translateZ(0px);
        }

        .side-table-leg-3 {
            left: 5px;
            bottom: 5px;
            height: 45px;
            transform: translateZ(0px);
        }

        .side-table-leg-4 {
            right: 5px;
            bottom: 5px;
            height: 45px;
            transform: translateZ(0px);
        }

        .view-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .view-btn {
            background: linear-gradient(45deg, #ecf0f1, #bdc3c7);
            border: 2px solid #95a5a6;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-btn:hover, .view-btn.active {
            background: linear-gradient(45deg, #3498db, #2c3e50);
            color: white;
            border-color: #2c3e50;
        }

        .controls {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid rgba(52, 152, 219, 0.2);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 700;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group input, .control-group select {
            width: 100%;
            padding: 12px 16px;
            border: 3px solid #bdc3c7;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-top: 25px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(52, 152, 219, 0.2);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        }

        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-panel p {
            color: #34495e;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 10px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>üèóÔ∏è 3D Room Planner</h1>
            
            <div class="view-controls">
                <button class="view-btn active" onclick="setView('isometric')">Isometric</button>
                <button class="view-btn" onclick="setView('top')">Top View</button>
            </div>
            
            <div class="furniture-list" id="furnitureList">
                <div class="furniture-item" draggable="true" data-type="bed">
                    <span class="furniture-icon">üõèÔ∏è</span>
                    <div class="furniture-name">Bed</div>
                </div>
                <div class="furniture-item" draggable="true" data-type="wardrobe">
                    <span class="furniture-icon">üö™</span>
                    <div class="furniture-name">Wardrobe</div>
                </div>
                <div class="furniture-item" draggable="true" data-type="table">
                    <span class="furniture-icon">ü™ë</span>
                    <div class="furniture-name">Table</div>
                </div>
                <div class="furniture-item" draggable="true" data-type="chair">
                    <span class="furniture-icon">üí∫</span>
                    <div class="furniture-name">Chair</div>
                </div>
                <div class="furniture-item" draggable="true" data-type="sofa">
                    <span class="furniture-icon">üõãÔ∏è</span>
                    <div class="furniture-name">Sofa</div>
                </div>
                <div class="furniture-item" draggable="true" data-type="side-table">
                    <span class="furniture-icon">üïØÔ∏è</span>
                    <div class="furniture-name">Side Table</div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="roomWidth">Room Width (px):</label>
                    <input type="number" id="roomWidth" value="800" min="400" max="1200" step="50">
                </div>
                <div class="control-group">
                    <label for="roomHeight">Room Height (px):</label>
                    <input type="number" id="roomHeight" value="600" min="300" max="900" step="50">
                </div>
                <div class="control-group">
                    <label for="floorTexture">Floor Pattern:</label>
                    <select id="floorTexture" onchange="changeFloorTexture()">
                        <option value="tiles">Tiles</option>
                        <option value="wood">Wooden</option>
                        <option value="carpet">Carpet</option>
                        <option value="marble">Marble</option>
                    </select>
                </div>
            </div>

            <div class="info-panel">
                <h3>Controls</h3>
                <p>‚Ä¢ <strong>Drag:</strong> Move furniture from list to room</p>
                <p>‚Ä¢ <strong>Click & Drag:</strong> Reposition placed items</p>
                <p>‚Ä¢ <strong>Double-click:</strong> Remove furniture</p>
                <p>‚Ä¢ <strong>View Buttons:</strong> Change camera angle</p>
            </div>
        </div>

        <div class="main-content">
            <div class="toolbar">
                <button onclick="clearRoom()">üóëÔ∏è Clear Room</button>
                <button onclick="saveLayout()">üíæ Save Design</button>
                <button onclick="loadLayout()">üìÇ Load Design</button>
                <button onclick="randomLayout()">üé≤ Random Layout</button>
                <span style="margin-left: auto; color: #2c3e50; font-weight: 700; font-size: 1.1rem;">
                    Furniture Count: <span id="itemCount" style="color: #3498db;">0</span>
                </span>
            </div>
            <div class="room-container">
                <div class="room-3d" id="room3d">
                    <div class="room-floor" id="roomFloor">
                        <!-- Walls -->
                        <div class="wall wall-back"></div>
                        <div class="wall wall-front"></div>
                        <div class="wall wall-left"></div>
                        <div class="wall wall-right"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedElement = null;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let furnitureCounter = 0;
        let currentView = 'isometric';

        function init() {
            setupDragAndDrop();
            setupRoomControls();
            updateItemCount();
        }

        function setupDragAndDrop() {
            const furnitureItems = document.querySelectorAll('.furniture-item');
            const roomFloor = document.getElementById('roomFloor');

            furnitureItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
            });

            roomFloor.addEventListener('dragover', handleDragOver);
            roomFloor.addEventListener('drop', handleDrop);
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.currentTarget.dataset.type);
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const furnitureType = e.dataTransfer.getData('text/plain');
            const room = e.currentTarget;
            const rect = room.getBoundingClientRect();
            
            let x = e.clientX - rect.left;
            let y = e.clientY - rect.top;
            
            x = Math.max(20, Math.min(x - 50, room.clientWidth - 150));
            y = Math.max(20, Math.min(y - 40, room.clientHeight - 100));
            
            createFurniture3D(furnitureType, x, y);
        }

        function createFurniture3D(type, x, y) {
            const room = document.getElementById('roomFloor');
            const furniture = document.createElement('div');
            const id = `furniture_${++furnitureCounter}`;
            
            furniture.id = id;
            furniture.className = `placed-furniture ${type}`;
            furniture.style.left = x + 'px';
            furniture.style.top = y + 'px';
            furniture.style.zIndex = furnitureCounter + 10;
            
            furniture.innerHTML = create3DModel(type);
            
            furniture.addEventListener('mousedown', handleMouseDown);
            furniture.addEventListener('dblclick', handleDoubleClick);
            
            room.appendChild(furniture);
            updateItemCount();
            
            // Entrance animation
            furniture.style.transform = 'scale(0)';
            furniture.style.opacity = '0';
            
            setTimeout(() => {
                furniture.style.transform = 'scale(1)';
                furniture.style.opacity = '1';
            }, 50);
        }

        function create3DModel(type) {
            switch(type) {
                case 'bed':
                    return `
                        <div class="furniture-3d bed-3d">
                            <div class="bed-frame"></div>
                            <div class="bed-mattress"></div>
                            <div class="bed-pillow"></div>
                        </div>
                    `;
                case 'wardrobe':
                    return `
                        <div class="furniture-3d wardrobe-3d">
                            <div class="wardrobe-body"></div>
                            <div class="wardrobe-door-left">
                                <div class="wardrobe-handle-left"></div>
                            </div>
                            <div class="wardrobe-door-right">
                                <div class="wardrobe-handle-right"></div>
                            </div>
                        </div>
                    `;
                case 'table':
                    return `
                        <div class="furniture-3d table-3d">
                            <div class="table-top"></div>
                            <div class="table-leg table-leg-1"></div>
                            <div class="table-leg table-leg-2"></div>
                            <div class="table-leg table-leg-3"></div>
                            <div class="table-leg table-leg-4"></div>
                        </div>
                    `;
                case 'chair':
                    return `
                        <div class="furniture-3d chair-3d">
                            <div class="chair-seat"></div>
                            <div class="chair-back"></div>
                            <div class="chair-leg chair-leg-1"></div>
                            <div class="chair-leg chair-leg-2"></div>
                            <div class="chair-leg chair-leg-3"></div>
                            <div class="chair-leg chair-leg-4"></div>
                        </div>
                    `;
                case 'sofa':
                    return `
                        <div class="furniture-3d sofa-3d">
                            <div class="sofa-base"></div>
                            <div class="sofa-back"></div>
                            <div class="sofa-arm-left"></div>
                            <div class="sofa-arm-right"></div>
                        </div>
                    `;
                case 'side-table':
                    return `
                        <div class="furniture-3d side-table-3d">
                            <div class="side-table-top"></div>
                            <div class="side-table-drawer">
                                <div class="side-table-handle"></div>
                            </div>
                            <div class="side-table-leg side-table-leg-1"></div>
                            <div class="side-table-leg side-table-leg-2"></div>
                            <div class="side-table-leg side-table-leg-3"></div>
                            <div class="side-table-leg side-table-leg-4"></div>
                        </div>
                    `;
                default:
                    return '<div>üì¶</div>';
            }
        }

        function handleMouseDown(e) {
            e.preventDefault();
            selectedElement = e.currentTarget;
            isDragging = true;
            
            document.querySelectorAll('.placed-furniture').forEach(el => {
                el.classList.remove('selected');
            });
            selectedElement.classList.add('selected');
            
            const rect = selectedElement.getBoundingClientRect();
            const roomRect = document.getElementById('roomFloor').getBoundingClientRect();
            
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }

        function handleMouseMove(e) {
            if (!isDragging || !selectedElement) return;
            
            const room = document.getElementById('roomFloor');
            const roomRect = room.getBoundingClientRect();
            
            let newX = e.clientX - roomRect.left - dragOffset.x;
            let newY = e.clientY - roomRect.top - dragOffset.y;
            
            newX = Math.max(10, Math.min(newX, room.clientWidth - selectedElement.offsetWidth - 10));
            newY = Math.max(10, Math.min(newY, room.clientHeight - selectedElement.offsetHeight - 10));
            
            selectedElement.style.left = newX + 'px';
            selectedElement.style.top = newY + 'px';
        }

        function handleMouseUp() {
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            selectedElement = null;
            isDragging = false;
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
        }

        function handleDoubleClick(e) {
            e.preventDefault();
            const element = e.currentTarget;
            
            element.style.transform = 'scale(0) rotateX(180deg)';
            element.style.opacity = '0';
            
            setTimeout(() => {
                element.remove();
                updateItemCount();
            }, 300);
        }

        function setupRoomControls() {
            const roomWidthInput = document.getElementById('roomWidth');
            const roomHeightInput = document.getElementById('roomHeight');
            
            roomWidthInput.addEventListener('input', updateRoomSize);
            roomHeightInput.addEventListener('input', updateRoomSize);
        }

        function updateRoomSize() {
            const roomFloor = document.getElementById('roomFloor');
            const room3d = document.getElementById('room3d');
            const width = document.getElementById('roomWidth').value;
            const height = document.getElementById('roomHeight').value;
            
            roomFloor.style.width = width + 'px';
            roomFloor.style.height = height + 'px';
            room3d.style.width = width + 'px';
            room3d.style.height = height + 'px';
            
            const furniture = roomFloor.querySelectorAll('.placed-furniture');
            furniture.forEach(item => {
                const currentX = parseInt(item.style.left);
                const currentY = parseInt(item.style.top);
                
                const newX = Math.min(currentX, width - item.offsetWidth - 10);
                const newY = Math.min(currentY, height - item.offsetHeight - 10);
                
                item.style.left = Math.max(10, newX) + 'px';
                item.style.top = Math.max(10, newY) + 'px';
            });
        }

        function setView(viewType) {
            const room3d = document.getElementById('room3d');
            const buttons = document.querySelectorAll('.view-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentView = viewType;
            
            switch(viewType) {
                case 'isometric':
                    room3d.style.transform = 'rotateX(45deg) rotateY(15deg) rotateZ(0deg)';
                    break;
                case 'top':
                    room3d.style.transform = 'rotateX(0deg) rotateY(0deg) rotateZ(0deg)';
                    break;
            }
        }

        function changeFloorTexture() {
            const floorTexture = document.getElementById('floorTexture').value;
            const roomFloor = document.getElementById('roomFloor');
            
            switch(floorTexture) {
                case 'tiles':
                    roomFloor.style.background = `
                        linear-gradient(45deg, 
                            rgba(236, 240, 241, 0.9) 25%, 
                            rgba(189, 195, 199, 0.3) 25%, 
                            rgba(189, 195, 199, 0.3) 50%, 
                            rgba(236, 240, 241, 0.9) 50%, 
                            rgba(236, 240, 241, 0.9) 75%, 
                            rgba(189, 195, 199, 0.3) 75%
                        )`;
                    roomFloor.style.backgroundSize = '50px 50px';
                    break;
                case 'wood':
                    roomFloor.style.background = `
                        linear-gradient(90deg, 
                            rgba(160, 82, 45, 0.8) 0%, 
                            rgba(210, 180, 140, 0.8) 25%, 
                            rgba(139, 69, 19, 0.8) 50%, 
                            rgba(205, 133, 63, 0.8) 75%, 
                            rgba(160, 82, 45, 0.8) 100%
                        )`;
                    roomFloor.style.backgroundSize = '120px 20px';
                    break;
                case 'carpet':
                    roomFloor.style.background = `
                        radial-gradient(circle, 
                            rgba(220, 20, 60, 0.3) 1px, 
                            rgba(139, 0, 139, 0.2) 1px, 
                            rgba(139, 0, 139, 0.2) 3px, 
                            transparent 3px
                        )`;
                    roomFloor.style.backgroundSize = '20px 20px';
                    break;
                case 'marble':
                    roomFloor.style.background = `
                        linear-gradient(45deg, 
                            rgba(248, 248, 255, 0.9) 25%, 
                            rgba(230, 230, 250, 0.7) 25%, 
                            rgba(230, 230, 250, 0.7) 50%, 
                            rgba(248, 248, 255, 0.9) 50%, 
                            rgba(248, 248, 255, 0.9) 75%, 
                            rgba(211, 211, 211, 0.5) 75%
                        )`;
                    roomFloor.style.backgroundSize = '60px 60px';
                    break;
            }
        }

        function updateItemCount() {
            const count = document.querySelectorAll('.placed-furniture').length;
            document.getElementById('itemCount').textContent = count;
        }

        function clearRoom() {
            if (confirm('Clear all furniture from the room?')) {
                const furniture = document.querySelectorAll('.placed-furniture');
                furniture.forEach((item, index) => {
                    setTimeout(() => {
                        item.style.transform = 'scale(0) rotateY(360deg)';
                        item.style.opacity = '0';
                        setTimeout(() => item.remove(), 400);
                    }, index * 100);
                });
                setTimeout(updateItemCount, furniture.length * 100 + 400);
            }
        }

        function randomLayout() {
            const furnitureTypes = ['bed', 'wardrobe', 'table', 'chair', 'sofa', 'side-table'];
            const room = document.getElementById('roomFloor');
            
            document.querySelectorAll('.placed-furniture').forEach(item => item.remove());
            
            const numItems = Math.floor(Math.random() * 4) + 3;
            
            for (let i = 0; i < numItems; i++) {
                setTimeout(() => {
                    const randomType = furnitureTypes[Math.floor(Math.random() * furnitureTypes.length)];
                    const x = Math.random() * (room.clientWidth - 150) + 20;
                    const y = Math.random() * (room.clientHeight - 100) + 20;
                    
                    createFurniture3D(randomType, x, y);
                }, i * 300);
            }
        }

        function saveLayout() {
            const furniture = [];
            document.querySelectorAll('.placed-furniture').forEach(item => {
                const classList = Array.from(item.classList);
                const type = classList.find(cls => cls !== 'placed-furniture');
                
                furniture.push({
                    type: type,
                    x: parseInt(item.style.left),
                    y: parseInt(item.style.top),
                    id: item.id
                });
            });
            
            const layout = {
                furniture: furniture,
                roomWidth: document.getElementById('roomWidth').value,
                roomHeight: document.getElementById('roomHeight').value,
                floorTexture: document.getElementById('floorTexture').value,
                view: currentView,
                timestamp: new Date().toISOString(),
                version: "3D Room Planner v2.0"
            };
            
            const dataStr = JSON.stringify(layout, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `room_design_${new Date().toISOString().slice(0,10)}.json`;
            link.click();
            
            showNotification('Design saved successfully!', 'success');
        }

        function loadLayout() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const layout = JSON.parse(e.target.result);
                        
                        document.querySelectorAll('.placed-furniture').forEach(item => item.remove());
                        
                        document.getElementById('roomWidth').value = layout.roomWidth;
                        document.getElementById('roomHeight').value = layout.roomHeight;
                        document.getElementById('floorTexture').value = layout.floorTexture || 'tiles';
                        
                        updateRoomSize();
                        changeFloorTexture();
                        
                        if (layout.view) {
                            setView(layout.view);
                        }
                        
                        furnitureCounter = 0;
                        layout.furniture.forEach((item, index) => {
                            setTimeout(() => {
                                createFurniture3D(item.type, item.x, item.y);
                            }, index * 200);
                        });
                        
                        showNotification('Design loaded successfully!', 'success');
                    } catch (error) {
                        showNotification('Error loading design: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                transform: translateX(100%);
                transition: all 0.3s ease;
                max-width: 300px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            `;
            
            switch(type) {
                case 'success':
                    notification.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                    break;
                default:
                    notification.style.background = 'linear-gradient(45deg, #3498db, #2c3e50)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', init);

        document.addEventListener('contextmenu', function(e) {
            if (e.target.closest('.placed-furniture')) {
                e.preventDefault();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Delete' && selectedElement) {
                handleDoubleClick({ preventDefault: () => {}, currentTarget: selectedElement });
            }
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveLayout();
            }
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                loadLayout();
            }
            if (e.key === 'Escape') {
                if (selectedElement) {
                    selectedElement.classList.remove('selected');
                    selectedElement = null;
                }
            }
        });
    </script>
</body>
</html>